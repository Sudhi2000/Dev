<div class="container-fluid">
    <div class="row" [formGroup]="Form">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div class="container-fluid d-flex justify-content-between header">
                        <div class="col-lg-8 ps-0">
                            <a routerLink="." class="nobleui-logo d-block mt-3">Target<span>
                                    Setting</span></a>
                            <p class="mt-1 mb-1"><b>Create a new target</b></p>
                        </div>
                        <div class="col-lg-4 pe-0">
                            <h6 class="fw-bold text-end mt-4 mb-2">Reporting Date</h6>
                            <h6 class="text-end mb-5 ">{{Form.value.reported_date| date:'MMM d, y'}}</h6>
                        </div>
                    </div>
                    <div class="container-fluid  d-flex justify-content-center w-100">
                        <div class="table-responsive w-100">
                            <div class="row">
                                <mat-tab-group mat-align-tabs="start" [(selectedIndex)]="selectedIndex">
                                    <mat-tab>
                                        <ng-template mat-tab-label>
                                            <mat-icon class="example-tab-icon">article</mat-icon>
                                            General Details
                                        </ng-template>
                                        <div class="row ">
                                            <div class="col-md-4">
                                                <mat-form-field fxFlex appearance="outline">
                                                    <mat-label>Division</mat-label>
                                                    <mat-select (selectionChange)="BusinessUnit($event)"
                                                        [formControl]="Division">
                                                        <mat-option *ngFor="let division of divisions"
                                                            [value]="division">
                                                            {{division.division_name}}</mat-option>
                                                    </mat-select>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Department</mat-label>
                                                    <input type="text" matInput formControlName="department">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field fxFlex appearance="outline">
                                                    <mat-label>Category</mat-label>
                                                    <mat-select formControlName="category"
                                                        (selectionChange)="category($event)">
                                                        <mat-option *ngFor="let category of categories"
                                                            value="{{category.attributes.Value}}">
                                                            {{category.attributes.Value}}</mat-option>
                                                    </mat-select>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>

                                        <div>

                                            <button type="button" class="btn btn-primary btn-icon-text mb-4"
                                                [disabled]="!Form.value.category " (click)="addSource()">
                                                <i class="feather icon-plus btn-icon-prepend"></i>
                                                Add Source *
                                            </button>

                                        </div>
                                        <div class="row mb-2" *ngIf="sourceList.length !== 0">
                                            <div class="pollutants-table-responsive pt-3" id="consumption">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <!-- <th>#</th> -->
                                                            <th>Source</th>
                                                            <th>Baseline Consumption</th>
                                                            <th>Standard</th>
                                                            <th>GHG Emission</th>
                                                            <th>Expected Savings</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let data of sourceList; let i = index">
                                                            <!-- <td></td> -->
                                                            <td>{{ data.source }}</td>
                                                            <td>{{ data.baseline_consumption }}</td>
                                                            <td>{{ data.standard }}</td>
                                                            <td>{{ data.GHG_emission }}</td>
                                                            <td>{{ data.expected_savings }}</td>
                                                            <td>
                                                                <button type="button"
                                                                    class="btn btn-danger btn-icon-text btn-xs action-btn float-start me-1"
                                                                    (click)="deleteSource(data,i)">
                                                                    <i class="feather icon-trash-2"></i>
                                                                </button>

                                                                <button type="button"
                                                                    class="btn btn-warning btn-icon-text btn-xs action-btn float-start me-1"
                                                                    (click)="editSource(data, i)">
                                                                    <i class="feather icon-edit"></i>
                                                                </button>
                                                                <button type="button"
                                                                    class="btn btn-primary btn-icon-text btn-xs action-btn float-start"
                                                                    (click)="viewSource(data)">
                                                                    <i class="feather icon-eye"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- <div class="row ">
                                            <div class="col-md-4">
                                                <mat-form-field fxFlex appearance="outline">
                                                    <mat-label>Source</mat-label>
                                                    <mat-select formControlName="source"
                                                        (selectionChange)="source($event)">
                                                        <mat-option *ngFor="let source of sources"
                                                            value="{{source.attributes.Value}}">
                                                            {{source.attributes.Value}}</mat-option>
                                                    </mat-select>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Baseline Consumption</mat-label>
                                                    <input type="number" matInput formControlName="baseline_consumption"
                                                        (change)="calcGhgEmission()">
                                                    <span class="suffix" matSuffix>{{Form.value.baseline_Unit}}</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4" *ngIf="Form.value.category == 'Energy'">
                                                <mat-form-field fxFlex appearance="outline">
                                                    <mat-label>Standard</mat-label>
                                                    <mat-select formControlName="standard"
                                                        (selectionChange)="CalculateGHG($event)">
                                                        <mat-option *ngFor="let standard of standards"
                                                            value="{{standard.attributes.Value}}">
                                                            {{standard.attributes.Value}}</mat-option>
                                                    </mat-select>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>GHG Emission</mat-label>
                                                    <input type="number" matInput
                                                        formControlName="expected_GHG_emission">
                                                    <span class="suffix" matSuffix>tCO₂e</span>

                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div> -->
                                        <div class="row mb-4 mt-4">
                                            <quill-editor placeholder="Findings / Problems" [modules]="quillConfig"
                                                formControlName="findings">
                                            </quill-editor>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="custom-dropzone" ngx-dropzone [accept]="'image/*'"
                                                (change)="onSelect($event)">
                                                <ngx-dropzone-label>Drop your evidences here. Please ensure the image
                                                    size is less than 2 MB</ngx-dropzone-label>
                                                <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview"
                                                    [removable]="true" *ngFor="let f of files" [file]="f"
                                                    (removed)="onRemove(f)">
                                                </ngx-dropzone-image-preview>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <button type="button" class="btn btn-primary btn-icon-text float-end mt-4"
                                                (click)="nextStep()">
                                                <i class="feather icon-arrow-right-circle btn-icon-prepend"></i>
                                                Next
                                            </button>
                                        </div>
                                    </mat-tab>
                                    <mat-tab>
                                        <ng-template mat-tab-label>
                                            <mat-icon class="example-tab-icon">event_note</mat-icon>
                                            Improvement Details
                                        </ng-template>
                                        <div class="row mb-4 mt-4">
                                            <quill-editor placeholder="Action" [modules]="quillConfig"
                                                formControlName="action">
                                            </quill-editor>
                                        </div>
                                        <div class="row ">
                                            <div class="col-md-12">
                                                <mat-form-field fxFlex appearance="outline">
                                                    <mat-label>Possibility Category</mat-label>
                                                    <mat-select formControlName="possibility_category"
                                                        (selectionChange)="possibility_category($event)">
                                                        <mat-option *ngFor="let category of possibilityCategory"
                                                            value="{{category.attributes.possible_category}}">
                                                            {{category.attributes.possible_category}}</mat-option>
                                                        <mat-option (click)="new_possible_category()"
                                                            class="option-btn"> <i
                                                                class="mdi mdi mdi-plus-circle"></i>Add a new Possible
                                                            Category</mat-option>

                                                    </mat-select>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="row ">
                                            <div class="col-md-12">
                                                <mat-form-field fxFlex appearance="outline">
                                                    <mat-label>Opportunity</mat-label>
                                                    <mat-select formControlName="possibility_subcategory"
                                                        [disabled]="!Form.get('possibility_category')?.value">
                                                        <mat-option *ngFor="let category of possibilitySubCat"
                                                            value="{{category.attributes.opportunity}}">
                                                            {{category.attributes.opportunity}}</mat-option>
                                                        <mat-option (click)="new_opportunity()" class="option-btn"> <i
                                                                class="mdi mdi mdi-plus-circle"></i>Add
                                                            Opportunity</mat-option>
                                                    </mat-select>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <button type="button" class="btn btn-primary btn-icon-text float-end mt-4"
                                                (click)="nextStep()">
                                                <i class="feather icon-arrow-right-circle btn-icon-prepend"></i>
                                                Next
                                            </button>
                                        </div>
                                    </mat-tab>

                                    <mat-tab>
                                        <ng-template mat-tab-label>
                                            <mat-icon class="example-tab-icon">ads_click</mat-icon>
                                            Target Setting
                                        </ng-template>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Implementation Cost</mat-label>
                                                    <input type="number" matInput formControlName="implementation_cost">
                                                    <span class="suffix" matSuffix>{{currency}}</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Annual Expected Savings</mat-label>
                                                    <input type="number" matInput formControlName="expected_saving"
                                                        readonly (change)="calcTargetReduction()">
                                                    <span class="suffix" matSuffix>{{Form.value.baseline_Unit}}</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Target GHG Reduction</mat-label>
                                                    <input type="number" matInput formControlName="target_reduction">
                                                    <span class="suffix" matSuffix>%</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Cost Saving</mat-label>
                                                    <input type="number" matInput formControlName="cost_saving"
                                                        (change)="calcPayBackPeriod()">
                                                    <span class="suffix" matSuffix>{{currency}}</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-8">
                                                <mat-form-field appearance="outline" color="primary" id="dashboard">
                                                    <mat-label>Implementation Timeline</mat-label>
                                                    <mat-date-range-input [formGroup]="dateRange"
                                                        [rangePicker]="picker">
                                                        <input matStartDate formControlName="start"
                                                            placeholder="Start date"
                                                            (dateChange)="startDateChange($event)">
                                                        <input matEndDate formControlName="end" placeholder="End date"
                                                            (dateChange)="endDateChange($event)">
                                                    </mat-date-range-input>
                                                    <mat-datepicker-toggle matSuffix
                                                        [for]="picker"></mat-datepicker-toggle>
                                                    <mat-date-range-picker #picker></mat-date-range-picker>
                                                    <mat-error
                                                        *ngIf="dateRange.controls.start.hasError('matStartDateInvalid')">Invalid
                                                        start date</mat-error>
                                                    <mat-error
                                                        *ngIf="dateRange.controls.end.hasError('matEndDateInvalid')">Invalid
                                                        end date
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Payback Period</mat-label>
                                                    <input type="number" matInput formControlName="payback_period">
                                                    <span class="suffix" matSuffix>Year</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Project Lifespan</mat-label>
                                                    <input type="number" matInput formControlName="project_lifespan">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <button type="button" class="btn btn-primary btn-icon-text float-end mt-4"
                                                (click)="submit()" [disabled]="!Form.valid">
                                                <i class="feather icon-send btn-icon-prepend"></i>
                                                Submit
                                            </button>
                                        </div>
                                    </mat-tab>
                                </mat-tab-group>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">
                    <div class="mt-3">
                        <button [disabled]="Form.value.status==='Completed'" class="btn btn-primary" mat-icon-button
                            aria-label="Example icon-button with a menu">
                            <i class="feather icon-more-horizontal btn-icon-prepend"></i> Open
                        </button>
                    </div>
                    <div class="mt-3">
                        <mat-form-field fxFlex appearance="outline" color="primary">
                            <mat-label>Responsible</mat-label>
                            <mat-select formControlName="responsible">
                                <mat-option *ngFor="let assignee of peopleList" [value]="assignee.id">
                                    <span>{{ assignee.attributes.first_name }}
                                        {{assignee.attributes.last_name}}</span>
                                </mat-option>
                            </mat-select>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>
                        <mat-form-field fxFlex appearance="outline" color="primary">
                            <mat-label>Approver</mat-label>
                            <mat-select formControlName="approver">
                                <mat-option *ngFor="let approver of peopleList" [value]="approver.id">
                                    <span>{{ approver.attributes.first_name }}
                                        {{approver.attributes.last_name}}</span>
                                </mat-option>
                            </mat-select>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>