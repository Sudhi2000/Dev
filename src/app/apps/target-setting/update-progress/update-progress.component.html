<div class="container-fluid">
    <div class="row" [formGroup]="Form">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div class="container-fluid d-flex justify-content-between header">
                        <div class="col-lg-8 ps-0">
                            <a routerLink="." class="nobleui-logo d-block mt-3">Target<span>
                                    Setting</span></a>
                            <h6 class=" mb-3"># {{Form.value.reference_number}}</h6>
                        </div>
                        <div class="col-lg-4 pe-0">
                            <h6 class="fw-bold text-end mt-4 mb-2">Date</h6>
                            <h6 class="text-end mb-5 ">{{Form.value.reported_date| date:'MMM d, y'}}</h6>
                        </div>
                    </div>
                    <div class="container-fluid  d-flex justify-content-center w-100">
                        <div class="table-responsive w-100">
                            <div class="row">
                                <mat-tab-group mat-align-tabs="start" [(selectedIndex)]="selectedIndex">
                                    <mat-tab>
                                        <ng-template mat-tab-label>
                                            <mat-icon class="example-tab-icon">article</mat-icon>
                                            General Details
                                        </ng-template>
                                        <div class="row ">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Division</mat-label>
                                                    <input type="text" matInput formControlName="division">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Department</mat-label>
                                                    <input type="text" matInput formControlName="department">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Category</mat-label>
                                                    <input type="text" matInput formControlName="category">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="row mb-2" *ngIf="sourceList.length !== 0">
                                            <div class="pollutants-table-responsive pt-3" id="consumption">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>

                                                            <th>Source</th>
                                                            <th>Baseline Consumption</th>
                                                            <th>Standard</th>
                                                            <th>GHG Emission</th>
                                                            <th>Expected Savings</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let data of sourceList; let i = index">

                                                            <td>{{ data.attributes.source }}</td>
                                                            <td>{{ data.attributes.baseline_consumption }}</td>
                                                            <td>{{ data.attributes.standard }}</td>
                                                            <td>{{ data.attributes.GHG_emission }}</td>
                                                            <td>{{ data.attributes.expected_savings }}</td>
                                                            <td>
                                                                <button type="button"
                                                                    class="btn btn-primary btn-icon-text btn-xs action-btn float-start"
                                                                    (click)="viewSource(data)">
                                                                    <i class="feather icon-eye"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <!-- <div class="row ">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Source</mat-label>
                                                    <input type="text" matInput formControlName="source">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Baseline Consumption</mat-label>
                                                    <input type="number" matInput
                                                        formControlName="baseline_consumption">
                                                    <span class="suffix" matSuffix>{{Form.value.baseline_Unit}}</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>GHG Emission</mat-label>
                                                    <input type="number" matInput
                                                        formControlName="expected_GHG_emission">
                                                    <span class="suffix" matSuffix>CO2</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div> -->
                                        <div class="row mb-4 mt-4">
                                            <quill-editor placeholder="Findings / Problems" [modules]="quillConfig"
                                                formControlName="findings">
                                            </quill-editor>
                                        </div>
                                        <div class="row mt-3 img-view">
                                            <a href="" (click)="false" class="col-md-2 ps-1 pe-1"
                                                *ngFor="let image of evidences; let i=index">
                                                <figure class="mb-2">
                                                    <img class="img-fluid rounded" [src]="image.src" (click)="open(i)"
                                                        width="150" alt="">
                                                </figure>
                                            </a>
                                        </div>
                                        <div class="mb-3">
                                            <button type="button" class="btn btn-primary btn-icon-text float-end mt-4"
                                                (click)="nextStep()">
                                                <i class="feather icon-arrow-right-circle btn-icon-prepend"></i>
                                                Next
                                            </button>
                                        </div>
                                    </mat-tab>
                                    <mat-tab>
                                        <ng-template mat-tab-label>
                                            <mat-icon class="example-tab-icon">event_note</mat-icon>
                                            Improvement Details
                                        </ng-template>
                                        <div class="row mb-4 mt-4">
                                            <quill-editor placeholder="Action" [modules]="quillConfig"
                                                formControlName="action">
                                            </quill-editor>
                                        </div>
                                        <div class="row ">
                                            <div class="col-md-12">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Possibility Category</mat-label>
                                                    <input type="text" matInput formControlName="possibility_category">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="row ">
                                            <div class="col-md-12">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Possibility Sub Category</mat-label>
                                                    <input type="text" matInput
                                                        formControlName="possibility_subcategory">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <button type="button" class="btn btn-primary btn-icon-text float-end mt-4"
                                                (click)="nextStep()">
                                                <i class="feather icon-arrow-right-circle btn-icon-prepend"></i>
                                                Next
                                            </button>
                                        </div>
                                    </mat-tab>
                                    <mat-tab>
                                        <ng-template mat-tab-label>
                                            <mat-icon class="example-tab-icon">ads_click</mat-icon>
                                            Target Setting
                                        </ng-template>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Implementation Cost</mat-label>
                                                    <input type="number" matInput formControlName="implementation_cost">
                                                    <span class="suffix" matSuffix>{{currency}}</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Annual Expected Savings</mat-label>
                                                    <input type="number" matInput formControlName="expected_saving"
                                                        (change)="calcTargetReduction()">
                                                    <!-- <span class="suffix" matSuffix>{{Form.value.baseline_Unit}}</span> -->
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Target GHG Reduction</mat-label>
                                                    <input type="number" matInput formControlName="target_reduction">
                                                    <span class="suffix" matSuffix>%</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Cost Saving</mat-label>
                                                    <input type="number" matInput formControlName="cost_saving"
                                                        (change)="calcPayBackPeriod()">
                                                    <span class="suffix" matSuffix>{{currency}}</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-8">
                                                <mat-form-field appearance="outline" color="primary" id="dashboard">
                                                    <mat-label>Implementation Timeline</mat-label>
                                                    <mat-date-range-input [formGroup]="dateRange"
                                                        [rangePicker]="picker">
                                                        <input matStartDate formControlName="start"
                                                            placeholder="Start date"
                                                            (dateChange)="startDateChange($event)">
                                                        <input matEndDate formControlName="end" placeholder="End date"
                                                            (dateChange)="endDateChange($event)">
                                                    </mat-date-range-input>
                                                    <mat-datepicker-toggle matSuffix [for]="picker">
                                                    </mat-datepicker-toggle>
                                                    <mat-date-range-picker #picker></mat-date-range-picker>
                                                    <mat-error
                                                        *ngIf="dateRange.controls.start.hasError('matStartDateInvalid')">
                                                        Invalid
                                                        start date</mat-error>
                                                    <mat-error
                                                        *ngIf="dateRange.controls.end.hasError('matEndDateInvalid')">
                                                        Invalid end date
                                                    </mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Payback Period</mat-label>
                                                    <input type="number" matInput formControlName="payback_period">
                                                    <span class="suffix" matSuffix>Year</span>
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-4">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Project Lifespan</mat-label>
                                                    <input type="number" matInput formControlName="project_lifespan">
                                                    <mat-error>Required Field</mat-error>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <button type="button" class="btn btn-primary btn-icon-text float-end mt-4"
                                                (click)="nextStep()">
                                                <i class="feather icon-arrow-right-circle btn-icon-prepend"></i>
                                                Next
                                            </button>
                                        </div>
                                    </mat-tab>
                                    <mat-tab *ngIf="Form.value.status==='In-Progress'">
                                        <ng-template mat-tab-label>
                                            <mat-icon class="example-tab-icon">trending_up</mat-icon>
                                            Progress
                                        </ng-template>
                                        <div class="row">
                                            <button type="button" class="btn btn-primary btn-icon-text"
                                                (click)="create_progress()">
                                                <i class="feather icon-plus-circle btn-icon-prepend"></i>
                                                Create Progress
                                            </button>
                                            <div class="table-responsive pt-3" id="targetProgress">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Year</th>
                                                            <th>Actual Savings</th>
                                                            <th>Targeted Energy Consumption</th>
                                                            <th>Actual GHG Emission</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let data of tergatedProgress">
                                                            <td></td>
                                                            <td>{{data.attributes.year}}</td>
                                                            <td>{{data.attributes.actual_savings}}</td>
                                                            <td>{{data.attributes.target_consumption}}</td>
                                                            <td>{{data.attributes.actual_ghs}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="custom-dropzone" ngx-dropzone [accept]="'image/*'"
                                                (change)="onSelect($event)">
                                                <ngx-dropzone-label>Drop your evidences here. Please ensure the image
                                                    size is less than 2 MB</ngx-dropzone-label>
                                                <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview"
                                                    [removable]="true" *ngFor="let f of files" [file]="f"
                                                    (removed)="onRemove(f)">
                                                </ngx-dropzone-image-preview>
                                            </div>
                                        </div>
                                    </mat-tab>
                                </mat-tab-group>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">
                    <div class="mt-3">
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary">{{Form.value.status}}</button>
                            <div class="btn-group" ngbDropdown role="group">
                                <button class="btn btn-primary dropdown-toggle-split" ngbDropdownToggle></button>
                                <div ngbDropdownMenu>
                                    <button ngbDropdownItem (click)="updateStatus('Approved')"
                                        *ngIf="Form.value.status==='Open'">Approve</button>
                                    <button ngbDropdownItem (click)="updateStatus('Rejected')"
                                        *ngIf="Form.value.status==='Open'">Reject</button>
                                    <button ngbDropdownItem (click)="updateStatus('Hold')"
                                        *ngIf="Form.value.status==='Open'">Hold</button>
                                    <button ngbDropdownItem (click)="updateStatus('Completed')"
                                        *ngIf="Form.value.status==='In-Progress'">Completed</button>
                                    <button ngbDropdownItem (click)="updateStatus('In-Progress')"
                                        *ngIf="Form.value.status==='Approved'">In Progress</button>
                                </div>
                                <button class="btn btn-success status-btn ms-2" mat-icon-button
                                    aria-label="Example icon-button with a menu" (click)="navigate()">
                                    <i class="feather icon-chevron-left"></i> Back to History

                                </button>
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="tx-11 fw-bolder mb-0 text-uppercase">Created By:</label>
                            <p class="text-muted">{{Form.value.createdby_name}},
                                {{Form.value.createdby_designation}}</p>
                        </div>
                        <div class="mt-3">
                            <label class="tx-11 fw-bolder mb-0 text-uppercase">Responsible:</label>
                            <p class="text-muted">{{Form.value.responsible_name}},
                                {{Form.value.responsible_designation}}</p>
                        </div>
                        <div class="mt-3">
                            <label class="tx-11 fw-bolder mb-0 text-uppercase">Approver:</label>
                            <p class="text-muted">{{Form.value.approver_name}},
                                {{Form.value.approver_designation}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>