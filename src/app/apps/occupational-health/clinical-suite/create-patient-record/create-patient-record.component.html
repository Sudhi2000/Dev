<div class="container-fluid">
  <div class="row" [formGroup]="Form">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body">
          <div class="container-fluid d-flex justify-content-between header">
            <div class="col-lg-8 ps-0">
              <a routerLink="." class="nobleui-logo d-block mt-3">Clinical Suite<span> </span></a>
              <p class="mt-1 mb-1">Create a new Patient Record</p>
            </div>
            <div class="col-lg-4 pe-0">
              <h6 class="fw-bold text-end mt-4 mb-2">Date</h6>
              <h6 class="text-end mb-5">
                {{ Form.value.reported_date | date : "MMM d, y" }}
              </h6>
            </div>
          </div>
          <div class="container-fluid d-flex justify-content-center w-100">
            <div class="table-responsive w-100">
              <div class="row">
                <div class="row">
                  <div class="col-md-6">
                    <mat-form-field appearance="outline">
                      <mat-label>Employee ID</mat-label>
                      <input type="text" matInput formControlName="employee_id" (blur)="checkEmployeeId()" />
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field appearance="outline">
                      <mat-label>Employee Name</mat-label>
                      <input type="text" matInput formControlName="employee_name" />
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field fxFlex appearance="outline" color="primary">
                      <mat-label>Gender</mat-label>
                      <mat-select formControlName="gender">
                        <mat-option *ngFor="let gender of genderData" value="{{ gender.attributes.Value }}">
                          {{ gender.attributes.Value }}</mat-option>
                      </mat-select>
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field appearance="outline">
                      <mat-label>Age</mat-label>
                      <input type="number" matInput formControlName="age" />
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field appearance="outline">
                      <mat-label>Designation</mat-label>
                      <mat-select formControlName="designation">
                        <mat-option *ngFor="let name of designations" value="{{ name.attributes.designation }}">
                          {{ name.attributes.designation }}</mat-option>

                        <mat-option (click)="new_designation()" class="option-btn">
                          <i class="mdi mdi-plus-circle"></i> Create designation
                        </mat-option>
                      </mat-select>
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field fxFlex appearance="outline">
                      <mat-label>Employee Division</mat-label>
                      <mat-select formControlName="division">
                        <mat-option *ngFor="let division of employeeDivisions"
                          value="{{ division.attributes.division_name }}">
                          {{ division.attributes.division_name }}</mat-option>
                      </mat-select>
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field fxFlex appearance="outline">
                      <mat-label>Department</mat-label>
                      <mat-select formControlName="department" (selectionChange)="getSubDepartments($event)">
                        <mat-option *ngFor="let name of departments" (click)="departmentID(name)"
                          value="{{ name.attributes.department_name }}">
                          {{ name.attributes.department_name }}</mat-option>

                        <mat-option (click)="new_department()" class="option-btn">
                          <i class="mdi mdi-plus-circle"></i> Create department
                        </mat-option>
                      </mat-select>
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>

                  <div class="col-md-4">
                    <mat-form-field fxFlex appearance="outline">
                      <mat-label>Sub Department</mat-label>
                      <mat-select formControlName="sub_department">
                        <mat-option *ngFor="let sub of filterSubDepartments" value="{{ sub }}">
                          {{ sub }}</mat-option>

                        <mat-option (click)="new_sub_department()" class="option-btn">
                          <i class="mdi mdi-plus-circle"></i> Create Sub
                          department
                        </mat-option>
                      </mat-select>
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field fxFlex appearance="outline" color="primary">
                      <mat-label>Work Status</mat-label>
                      <mat-select formControlName="work_status">
                        <mat-option *ngFor="let status of workstaus_Data" value="{{ status.attributes.Value }}">
                          {{ status.attributes.Value }}</mat-option>
                      </mat-select>
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>

                  <div class="col-md-8">
                    <mat-form-field fxFlex appearance="outline" color="primary">
                      <mat-label>Symptoms</mat-label>
                      <input type="text" matInput placeholder="Please search here" [matAutocomplete]="autoSymptoms"
                        [formControl]="Symptoms" [value]="displaySelectedSymptoms()" (focus)="onInputFocus()"
                        (input)="onInputChanged($event)" />
                      <mat-autocomplete #autoSymptoms="matAutocomplete">
                        <mat-option *ngFor="let data of filteredSymptoms | async"
                          (click)="toggleSelection(data.attributes.name)">
                          <div class="option-container">
                            <mat-checkbox [checked]="selectedSymptoms.includes(data.attributes.name)">
                              {{ data.attributes.name }}
                            </mat-checkbox>
                            <div class="icon-container" (click)="$event.stopPropagation()">
                              <i class="feather icon-edit titleicon_edit" (click)="update_symptom(data.id)"></i>&nbsp;
                              <i class="feather icon-trash-2 titleicon_delete" (click)="delete_symptom(data.id)"></i>
                            </div>
                          </div>
                        </mat-option>
                        <mat-option (click)="new_symptoms()" class="option-btn">
                          <i class="mdi mdi-plus-circle"></i> Create new Symptom
                        </mat-option>
                      </mat-autocomplete>
                      <mat-error>Required Field</mat-error>
                    </mat-form-field>
                  </div>
                </div>

                <div class="mb-3">
                  <button type="button" class="btn btn-success btn-icon-text float-end mt-4" (click)="submit()"
                    [disabled]="!Form.valid">
                    <i class="feather icon-send btn-icon-prepend"></i>
                    Submit
                  </button>
                  <button type="button" class="btn btn-secondary btn-icon-text float-end mt-4 action-btn"
                    (click)="saveAsDraft()" [disabled]="
                      !Form.value.employee_id || !Form.value.clinic_division
                    ">
                    <i class="feather icon-save btn-icon-prepend"></i>
                    Save as Draft
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card">
        <div class="card-body">
          <div class="mt-3">
            <button class="btn btn-primary" mat-icon-button aria-label="Example icon-button with a menu">
              {{ Form.value.status }}
            </button>
          </div>

          <div class="mt-3">
            <!-- Check-In Date -->
            <mat-form-field appearance="outline" color="primary">
              <mat-label>Check-In Date</mat-label>
              <input matInput [matDatepicker]="accdp" placeholder="Choose a date" [formControl]="checkinDate"
                (dateChange)="checkinDateVal($event)" />
              <mat-datepicker-toggle matSuffix [for]="accdp"></mat-datepicker-toggle>
              <mat-datepicker #accdp></mat-datepicker>
              <mat-error>Required Field</mat-error>
            </mat-form-field>

            <!-- Check-In Time -->
            <mat-form-field fxFlex appearance="outline" color="warning">
              <mat-label>Check-In Time</mat-label>
              <input matTimepicker #t="matTimepicker" [strict]="false" id="timepicker-example" mode="12h"
                placeholder="Please select time..." name="time" [formControl]="checkinTime"
                (timeChange)="checkinTimeValue($event)" />
              <mat-icon matSuffix (click)="t.showDialog()">access_time</mat-icon>
              <mat-error>Required Field</mat-error>
            </mat-form-field>
          </div>

          <div>
            <p class="mt-1 mb-1">Preliminary Checkup Data</p>
          </div>
          <div class="col-md-12" [hidden]="Form.get('use_celsius')?.value">
            <mat-form-field appearance="outline">
              <mat-label>Body Temperature (°F)</mat-label>
              <input type="number" matInput formControlName="temp_fahrenheit" (change)=" bodyTempFahrenheit($event)" />
              <mat-error>Required Field</mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6 mt-2">

            <div class="form-check form-switch mb-2">
              <input type="checkbox" class="form-check-input" id="formSwitch2" formControlName="use_celsius">
              <label class="form-check-label" for="formSwitch2">Temperature in Celsius</label>
            </div>
          </div>


          <div [hidden]="!Form.get('use_celsius')?.value" class="mt-3">
            <div class="row">
              <div class="col-md-12">
                <mat-form-field appearance="outline">
                  <mat-label>Body Temperature (°C)</mat-label>
                  <input type="number" matInput formControlName="temp_celsius" (change)="bodyTemp ($event)" />
                  <mat-error>Required Field</mat-error>
                </mat-form-field>
              </div>
            </div>
          </div>


          <div class="col-md-12">
            <mat-form-field appearance="outline">
              <mat-label> Weight (KG)</mat-label>
              <input type="number" matInput formControlName="weight" (change)="bmiCalc()" />
              <mat-error>Required Field</mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-12" [hidden]="Form.get('use_feet_inches')?.value">
            <mat-form-field appearance="outline">
              <mat-label> Height (M)</mat-label>
              <input type="number" matInput formControlName="height" (change)="bmiCalc()" />
              <mat-error>Required Field</mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6 mt-2">

            <div class="form-check form-switch mb-2">
              <input type="checkbox" class="form-check-input" id="formSwitch2" formControlName="use_feet_inches"
                (change)="UseFeetAndInches($event)">
              <label class="form-check-label" for="formSwitch2">Use Feet and Inches</label>
            </div>
          </div>


          <div [hidden]="!Form.get('use_feet_inches')?.value" class="mt-3">
            <div class="row">
              <div class="col-md-6">
                <mat-form-field appearance="outline">
                  <mat-label>Feet</mat-label>
                  <input type="number" matInput formControlName="feet"
                    (change)="findHeight(Form.value.feet,Form.value.inches)">
                  <mat-error>Required Field</mat-error>
                </mat-form-field>
              </div>
              <div class="col-md-6">
                <mat-form-field appearance="outline">
                  <mat-label>Inches</mat-label>
                  <input type="number" matInput formControlName="inches"
                    (change)="findHeight(Form.value.feet,Form.value.inches)">
                  <mat-error>Required Field</mat-error>

                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="col-md-12">
            <mat-form-field appearance="outline">
              <mat-label>Blood Pressure (mm Hg)</mat-label>
              <input type="text" matInput formControlName="blood_pressure" />
              <mat-error>Required Field</mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-12">
            <mat-form-field appearance="outline">
              <mat-label>Random Blood Sugar</mat-label>
              <input type="text" matInput formControlName="random_blood_sugar" />
              <mat-error>Required Field</mat-error>
            </mat-form-field>
          </div>

          <div class="col-md-12">
            <mat-form-field appearance="outline">
              <mat-label>Consulting Doctor</mat-label>
              <mat-select formControlName="consulting_doctor">
                <mat-option *ngFor="let user of userList" [value]="user.id">
                  <img style="vertical-align: middle; margin-right: 4px"
                    src="{{ user?.attributes?.image?.data?.attributes?.image }}" height="30" />
                  <span>{{ user.attributes.first_name }}
                    {{ user.attributes.last_name }}</span>
                </mat-option>
              </mat-select>
              <mat-error>Required Field</mat-error>
            </mat-form-field>
          </div>

          <div class="col-md-12">
            <mat-form-field fxFlex appearance="outline">
              <mat-label>Clinic Division</mat-label>
              <mat-select (selectionChange)="BusinessUnit($event)" [formControl]="ClinicDivision">
                <mat-option *ngFor="let division of divisions" [value]="division">
                  {{ division.division_name }}</mat-option>
              </mat-select>
              <mat-error>Required Field</mat-error>
            </mat-form-field>

            <div id="bmi-chart">
              <p class="mt-1 mb-1">Body Mass Index (BMI)</p>
              <button type="button" class="btn {{ btnStyle }}">
                {{ bmiText }}
                <span class="badge text-dark">{{ bmiValue }}</span>
              </button>
              <div id="gaugeArea"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>