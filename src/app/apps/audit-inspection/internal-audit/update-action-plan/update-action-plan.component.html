<div class="container-fluid">
    <div class="row" [formGroup]="Form">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div class="container-fluid d-flex justify-content-between header">
                        <div class="col-lg-8 ps-0">
                            <a routerLink="." class="nobleui-logo d-block mt-3">Internal<span>
                                    Audit</span></a>
                            <p class="mt-1 mb-1"><b>Update Action plan</b></p>
                        </div>
                        <div class="col-lg-4 pe-0">
                            <h6 class="fw-bold text-end mt-4 mb-2">Reported Date</h6>
                            <h6 class="text-end mb-3 ">{{Form.value.date| date:'MMM d, y'}}</h6>
                        </div>
                    </div>
                    <div class="container-fluid  d-flex justify-content-center w-100">
                        <div class="table-responsive w-100">
                            <div class="row mt-1">
                                <p class="mt-1 mb-1">Finding</p>
                            </div>
                            <div class="row">
                                <div class="col-md-12 grid-margin">
                                    <quill-editor placeholder="Findings" [modules]="quillConfig"
                                        formControlName="findings">
                                    </quill-editor>
                                </div>
                            </div>
                            <div class="row mt-3 mb-4 text-center">
                                <div class="d-grid gap-2">

                                    <button type="button" class="btn btn-secondary" id="ai-suggest"
                                        (click)="checkFindings()">AI -
                                        Suggest Sustainable Solution</button>
                                    <p class="error hide" id="error-text">Please provide your findings in findings field
                                    </p>
                                    <button type="button" class="btn btn-success hide" id="ai-loader">
                                        <span class="spinner-grow spinner-grow-sm" role="status"
                                            aria-hidden="true"></span>
                                        Please wait our AI is looking recommendations for sustainable solution.
                                    </button>

                                </div>

                            </div>
                            <div class="row mb-5">
                                <quill-editor placeholder="Recommendation for sustainable solution"
                                    [modules]="quillConfig" formControlName="sustainable_solution">
                                </quill-editor>
                            </div>

                            <div class="row mt-3 mb-4 text-center">
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-secondary" id="root-cause-ai-suggest"
                                        (click)="checkRootCause()">AI - Suggest Root Cause</button>
                                    <p class="error hide" id="root-cause-error-text">Please provide your findings in
                                        findings field</p>
                                    <button type="button" class="btn btn-success hide" id="root-cause-ai-loader">
                                        <span class="spinner-grow spinner-grow-sm" role="status"
                                            aria-hidden="true"></span>
                                        Please wait our AI is looking recommendations for Root Cause.
                                    </button>
                                </div>
                            </div>

                            <div class="row mt-3">
                                <p class="mt-1 mb-1">Recommendations For Root Cause?</p>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <quill-editor placeholder="Please provide the root cause" [modules]="quillConfig"
                                        formControlName="root_cause">
                                    </quill-editor>
                                </div>
                            </div>

                            <div class="row mt-3">
                                <p class="mt-1 mb-1">Barriers/Challenges</p>

                            </div>
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <quill-editor placeholder="Please recommend any barriers/challenges"
                                        [modules]="quillConfig" formControlName="barrier_challenges">
                                    </quill-editor>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <p class="mt-1 mb-1">Assignee Action Plan</p>

                            </div>
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <quill-editor placeholder="Please provide your action plan" [modules]="quillConfig"
                                        formControlName="assignee_remark">
                                    </quill-editor>
                                </div>
                            </div>
                            <div class="row mt-3" *ngIf="Form.value.status === 'Approved' || Form.value.status === 'Modification Required' || Form.value.status === 'Under Implementation'">
                                <p class="mt-1 mb-1">Approver Remarks</p>

                            </div>
                            <div class="row mt-3" *ngIf="Form.value.status === 'Approved' || Form.value.status === 'Modification Required' || Form.value.status === 'Under Implementation'">
                                <div class="col-md-12" >
                                    <quill-editor placeholder="Approver remarks" [modules]="quillConfig"
                                        formControlName="approver_remark" [disabled]="true">
                                    </quill-editor>
                                </div>
                            </div>
                            <div class="row mt-3" *ngIf="Form.value.status === 'Approved'|| Form.value.status === 'Under Implementation'">
                                <p class="mt-1 mb-1">Implemented Actions</p>

                            </div>
                            <div class="row mt-3" *ngIf="Form.value.status === 'Approved'|| Form.value.status === 'Under Implementation'">
                                <div class="col-md-12" >
                                    <quill-editor placeholder="Implemented Actions" [modules]="quillConfig"
                                        formControlName="implemented_actions" [disabled]="true">
                                    </quill-editor>
                                </div>
                            </div>
                            <div class="row mt-3" *ngIf="Form.value.status === 'Approved'|| Form.value.status === 'Under Implementation'">
                                <p class="mt-1 mb-1">Lessons Learned </p>

                            </div>
                            <div class="row mt-3" *ngIf="Form.value.status === 'Approved'|| Form.value.status === 'Under Implementation'" >
                                <div class="col-md-12" >
                                    <quill-editor placeholder="Lessons Learned" [modules]="quillConfig"
                                        formControlName="lessons_learned" [disabled]="true">
                                    </quill-editor>
                                </div>
                            </div>

                            <div class="row mt-3" *ngIf="Form.value.evidence!==0">
                                <div>
                                    <p *ngIf="evidence_Before">Evidence Before</p>
                    
                                </div>
                                <div class="custom-dropzone-container">
                                    <div *ngFor="let file of DocumentFiles; let i = index;" class="custom-dropzone">
                                        <ngx-dropzone-preview ngProjectAs="ngx-dropzone-preview" [file]="file" (click)="openDocument(i); $event.stopPropagation();">
                                            <ngx-dropzone-label class="preview-text">
                                                <div class="preview-text">{{ file.name }}</div>
                                            </ngx-dropzone-label>
                                        </ngx-dropzone-preview>
                                    </div>
                                </div>
                                
                            </div>

                            <div class="row mt-3" *ngIf="multiple_evidence_Before">
                                <div>
                                    <p>Multiple Evidence Before</p>
                    
                                </div>
                               
                                <div class="custom-dropzone-container">
                                    <div *ngFor="let file of MultipleDoumentBeforeFiles; let i = index;" class="custom-dropzone">
                                        <ngx-dropzone-preview ngProjectAs="ngx-dropzone-preview" [file]="file" (click)="openMultipeBeforeDocument(i); $event.stopPropagation();">
                                            <ngx-dropzone-label class="preview-text">
                                                <div class="preview-text">{{ file.name }}</div>
                                            </ngx-dropzone-label>
                                        </ngx-dropzone-preview>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="col-md-12" *ngIf="Form.value.status === 'Under Implementation'">
                                <div class="row mt-3">
                                    <p class="mt-1 mb-1">Evidence After</p>
                
                                </div>
                                <ngx-dropzone [accept]="'image/*'" (change)="onUpload($event)">
                                    <ngx-dropzone-label>
                                        Drop your Evidence After here
                                    </ngx-dropzone-label>
                                    <div *ngFor="let file of evidenceAfterFiles; let i = index;">
                                        <ngx-dropzone-preview ngProjectAs="ngx-dropzone-preview" [removable]="true" [file]="file"
                                            (removed)="onRemove(file)" [file]="file"
                                            (click)="openEvidenceAfter(i); $event.stopPropagation();">
                                            <ngx-dropzone-label class="preview-text">
                                                <div class="preview-text">
                                                    {{ file.name }}
                                                </div>
                                            </ngx-dropzone-label>
                                        </ngx-dropzone-preview>
                                    </div>
                                </ngx-dropzone>
                            </div>

                            <div class="form-check form-switch mb-3 mt-3" *ngIf="addMoreEvidence">
                                <input type="checkbox" class="form-check-input" id="formSwitch1"
                                    formControlName="add_more_evidence">
                                <label class="form-check-label" for="formSwitch1">Add more evidence</label>
                            </div>

                            <div class="col-md-12" *ngIf="Form.value.add_more_evidence">
                                <ngx-dropzone [accept]="'image/*'" (change)="onSelectMoreEvidence($event)">
                                    <ngx-dropzone-label>
                                        Drop More Evidences here
                                    </ngx-dropzone-label>
                                    <div *ngFor="let f of moreFiles; let i = index" >
                                        <ngx-dropzone-preview ngProjectAs="ngx-dropzone-preview" [removable]="true" 
                                         [file]="f"  (click)="openMultipleEvidenceAfter(i); $event.stopPropagation();" (removed)="onRemoveMoreEvidence(f,i)">
                                            <ngx-dropzone-label class="preview-text">
                                                <div class="preview-text">
                                                    {{ f.name }}
                                                </div>
                                            </ngx-dropzone-label>
                                        </ngx-dropzone-preview>
                                  </div>
                                </ngx-dropzone>
                            </div>
                        </div>
                       </div>
                        
                       
                        <div class="col-md-12" *ngIf="evidenceAfterFiles.length > 0 && Form.value.status === 'Implemented'">
                            <div class="row mt-3">
                                <p class="mt-1 mb-1">Evidence After</p>
            
                            </div>
                            <div class="custom-dropzone-container">
                                <div *ngFor="let file of evidenceAfterFiles; let i = index;" class="custom-dropzone">
                                    <ngx-dropzone-preview ngProjectAs="ngx-dropzone-preview" [file]="file"
                                        (click)="openEvidenceAfter(i); $event.stopPropagation();">
                                        <ngx-dropzone-label class="preview-text">
                                            <div class="preview-text">{{ file.name }}</div>
                                        </ngx-dropzone-label>
                                    </ngx-dropzone-preview>
                                </div>
                            </div>
            
                        </div>
               
                    <div class="mb-3">

                        <button type="button" class="btn btn-success btn-icon-text float-end mt-4 com-btn"
                        *ngIf=" Form.value.status === 'Modification Required' || Form.value.status === 'In Progress' || Form.value.status === 'Open' "
                            (click)="submit()" [disabled]="!Form.value.heirarchy_control || !Form.value.target_completion_date || !Form.value.root_cause 
                            || !Form.value.sustainable_solution || !Form.value.barrier_challenges || !Form.value.assignee_remark ">
                            <i class="feather icon-send btn-icon-prepend"></i>
                            Submit for Approval
                        </button>

                        <button type="button" class="btn btn-success btn-icon-text float-end mt-4"
                        *ngIf="Form.value.status === 'Under Implementation'" (click)="Implementation()"
                        [disabled]="!Form.value.lessons_learned|| !Form.value.implemented_actions" >
                        <i class="feather icon-send btn-icon-prepend"></i>
                        Implemented
                    </button>

                        <button type="button" class="btn btn-secondary btn-icon-text float-end mt-4 save-btn"
                        *ngIf="Form.value.status === 'Open'|| Form.value.status === 'In Progress'"
                            (click)="updateForm()">
                            Update
                        </button>

                     <button type="button" class="btn btn-secondary btn-icon-text float-end mt-4 save-btn"
                    *ngIf="Form.value.status === 'Approved'" (click)="StartImplementation()" >
                    Start Implementation
                     </button>

                    </div>

                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">

                    <div class="mt-3">
                        <div class="btn-group">
                            <div class="btn-group" ngbDropdown role="group">
                                <button class="btn btn-primary">
                                    {{Form.value.status}}</button>
                            </div>
                        </div>
                        <button class="btn btn-secondary back-button mx-1" aria-label="Example icon-button with a menu"
                            (click)="go_back()">
                            Go Back
                        </button>
                    </div>

                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase">Severity:</label>
                        <p class="text-muted">{{Form.value.priority}}</p>
                    </div>

                    <div class="mt-3">

                        <mat-form-field appearance="outline" color="primary">
                            <mat-label>Due Date</mat-label>
                            <input matInput [matDatepicker]="dueDatedp" placeholder="Choose a date"
                                [formControl]="dueDate" (dateChange)="due_date($event)">
                            <mat-datepicker-toggle matSuffix [for]="dueDatedp"></mat-datepicker-toggle>
                            <mat-datepicker #dueDatedp></mat-datepicker>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" color="primary">
                            <mat-label>Target Completion Date</mat-label>
                            <input matInput readonly [matDatepicker]="taComDatedp" placeholder="Choose a date"
                                [formControl]="TarcomDatedp" (dateChange)="targetcomplete_date($event)">
                            <mat-datepicker-toggle matSuffix [for]="taComDatedp"></mat-datepicker-toggle>
                            <mat-datepicker #taComDatedp></mat-datepicker>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>

                        <mat-form-field fxFlex appearance="outline" color="primary">
                            <mat-label>Hierarchy of Control</mat-label>
                            <mat-select formControlName="heirarchy_control">
                                <mat-option *ngFor="let value of heirarchy_dropdown" value="{{value}}">
                                    {{value}}</mat-option>
                            </mat-select>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>

                        <mat-form-field fxFlex appearance="outline" color="primary">
                            <mat-label>Approver</mat-label>
                            <mat-select formControlName="approver">
                                <mat-option *ngFor="let approver of peopleList" [value]="approver.id">
                                    <span>{{ approver?.attributes?.first_name }}
                                        {{approver?.attributes?.last_name}}</span>
                                </mat-option>
                            </mat-select>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>
                  
                    </div>



                </div>
            </div>
        </div>
    </div>
</div>