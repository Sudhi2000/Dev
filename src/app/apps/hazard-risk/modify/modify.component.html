<div class="container-fluid">
    <div class="row" [formGroup]="Form">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div class="container-fluid d-flex justify-content-between header">
                        <div class="col-lg-8 ps-0">
                            <a routerLink="." class="nobleui-logo d-block mt-3">Hazard & Risk<span>
                                    Management</span></a>
                            <h6 class=" mb-2 pb-3"># {{Form.value.reference_number}}</h6>
                        </div>
                        <div class="col-lg-4 pe-0">
                            <h6 class="fw-bold text-end mt-4 mb-2">Reporting Date</h6>
                            <h6 class="text-end mb-2 pb-3">{{Form.value.reported_date| date:'MMM d, y'}}</h6>
                        </div>
                    </div>
                    <div class="container-fluid  d-flex justify-content-center w-100">
                        <div class="table-responsive w-100">
                            <div class="row ">
                                <div class="col-md-6">
                                    <mat-form-field fxFlex appearance="outline">
                                        <mat-label>Category</mat-label>
                                        <mat-select formControlName="category" (selectionChange)="subCategory($event)">
                                            <mat-option *ngFor="let category of categories"
                                                value="{{category.attributes.Value}}">
                                                {{category.attributes.Value}}</mat-option>
                                        </mat-select>
                                        <mat-error>Required Field</mat-error>
                                    </mat-form-field>
                                </div>
                                <div class="col-md-6">
                                    <mat-form-field fxFlex appearance="outline">
                                        <mat-label>Sub Category</mat-label>
                                        <mat-select formControlName="sub_category"
                                            (selectionChange)="observation($event)">
                                            <mat-option *ngFor="let subcategory of subcategories"
                                                value="{{subcategory.attributes.Value}}">
                                                {{subcategory.attributes.Value}}</mat-option>
                                        </mat-select>
                                        <mat-error>Required Field</mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-md-12">
                                    <mat-form-field fxFlex appearance="outline">
                                        <mat-label>Observation Type</mat-label>
                                        <mat-select formControlName="observation">
                                            <mat-option *ngFor="let observation of observations"
                                                value="{{observation.attributes.observation}}">
                                                {{observation.attributes.observation}}</mat-option>
                                        </mat-select>
                                        <mat-error>Required Field</mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="row">
                                <div *ngIf="Form.controls['observation'].value" class="col-md-12">
                                    <div class="selected-observation">
                                        <strong>Observation:</strong> {{ Form.controls['observation'].value }}
                                    </div>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-md-6">
                                    <mat-form-field fxFlex appearance="outline">
                                        <mat-label>Division</mat-label>
                                        <mat-select [formControl]="Division" (selectionChange)="BusinessUnit($event)">
                                            <mat-option [value]="data.division_name"
                                                *ngFor="let data of divisions">{{data.division_name}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error>Required Field</mat-error>
                                    </mat-form-field>
                                </div>
                                <div class="col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Location / Department</mat-label>
                                        <input type="text" matInput formControlName="location_department">
                                        <mat-error>Required Field</mat-error>
                                    </mat-form-field>

                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Sub Location</mat-label>
                                        <input type="text" matInput formControlName="sub_location">
                                        <mat-error>Required Field</mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <quill-editor placeholder="Description" [modules]="quillConfig"
                                    formControlName="description">
                                </quill-editor>
                            </div>

                            <div class="row mt-3">
                                <div class="custom-dropzone" ngx-dropzone [accept]="'image/*'"
                                    (change)="onSelect($event)">
                                    <ngx-dropzone-label>Drop your evidences here. Please ensure the image
                                        size is less than 10 MB</ngx-dropzone-label>
                                    <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview" [removable]="true"
                                        *ngFor="let f of files; let i = index;" [file]="f" (removed)="onRemove(f,i)">
                                    </ngx-dropzone-image-preview>
                                </div>
                                <p *ngIf="!Form.controls['evidence'].valid" class="warning-font-size">Required Field *
                                </p>
                            </div>

                            <div class="form-check form-switch mb-3 mt-3" *ngIf="addMoreEvidence">
                                <input type="checkbox" class="form-check-input" id="formSwitch1"
                                    formControlName="add_more_evidence">
                                <label class="form-check-label" for="formSwitch1">Add more evidence</label>
                            </div>

                            <div class="row mt-3" *ngIf="Form.value.add_more_evidence">
                                <div class="custom-dropzone" ngx-dropzone [accept]="'image/*'"
                                    (change)="onSelectMoreEvidence($event)">
                                    <ngx-dropzone-label>Drop more evidences here. Please ensure the image
                                        size is less than 10 MB</ngx-dropzone-label>
                                    <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview" [removable]="true"
                                        *ngFor="let f of moreFiles; let i = index;" [file]="f"
                                        (removed)="onRemoveMoreEvidence(f,i)">
                                    </ngx-dropzone-image-preview>
                                </div>
                            </div>



                        </div>
                    </div>

                    <div class="mb-3">
                        <button *ngIf="Form.value.status ==='Draft'" type="button"
                            class="btn btn-success btn-icon-text float-end mt-4 status-btn"
                            (click)="submit('Submit-notify')" [disabled]="!Form.valid">
                            <i class="feather icon-send btn-icon-prepend"></i>
                            Submit
                        </button>
                        <button *ngIf="Form.value.status !=='Draft'" type="button"
                            class="btn btn-success btn-icon-text float-end mt-4 status-btn" (click)="submit('Submit')"
                            [disabled]="!Form.valid">
                            <i class="feather icon-send btn-icon-prepend"></i>
                            Submit
                        </button>
                        <button *ngIf="Form.value.status ==='Draft'" type="button"
                            class="btn btn-primary btn-icon-text float-end mt-4 " (click)="submit('Save')"
                            [disabled]="!isFormValid()">
                            <i class="feather icon-save btn-icon-prepend"></i>
                            Update
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">
                    <div class="mt-3">
                        <button [disabled]="Form.value.status==='Completed'" class="btn btn-primary" mat-icon-button
                            aria-label="Example icon-button with a menu">
                            <i class="feather icon-more-horizontal btn-icon-prepend"></i> {{Form.value.status}}
                        </button>

                        <button class="btn btn-success status-btn" mat-icon-button
                            aria-label="Example icon-button with a menu" (click)="navigate()">
                            <i class="feather icon-chevron-left"></i> Back to History

                        </button>
                    </div>
                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase">Reported By:</label>
                        <p class="text-muted">{{Form.value.reporterName}}, {{Form.value.reporterDesignation}}</p>
                    </div>

                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase">Risk Level *:</label><br>
                        <mat-button-toggle-group name="fontStyle" aria-label="Font Style" formControlName="level"
                            #group="matButtonToggleGroup" (change)="riskLevel($event)">
                            <mat-button-toggle value="High">High</mat-button-toggle>
                            <mat-button-toggle value="Medium">Medium</mat-button-toggle>
                            <mat-button-toggle value="Low">Low</mat-button-toggle>
                        </mat-button-toggle-group>
                    </div>
                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase"></label><br>
                        <mat-button-toggle-group name="fontStyle" aria-label="Font Style" formControlName="unsafe"
                            #group="matButtonToggleGroup">
                            <mat-button-toggle value="Unsafe Act">Unsafe Act</mat-button-toggle>
                            <mat-button-toggle value="Unsafe Condition">Unsafe Condition</mat-button-toggle>
                        </mat-button-toggle-group>
                        <div *ngIf="Form.controls['unsafe'].invalid" class="warning-font-safe">
                            Required Field *
                        </div>
                    </div>
                    <div class="mt-3">
                        <mat-form-field appearance="outline" color="primary">
                            <mat-label>Due Date</mat-label>
                            <input matInput [matDatepicker]="dp" [min]="minDate" placeholder="Choose a date"
                                [formControl]="duedate" (dateChange)="dueDate($event)">
                            <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                            <mat-datepicker #dp></mat-datepicker>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>

                        <mat-form-field fxFlex appearance="outline" color="primary">
                            <mat-label>Assignee</mat-label>
                            <mat-select formControlName="assignee" (valueChange)="responsible($event)">
                                <mat-option *ngFor="let people of peopleList" [value]="people.id">
                                    <img style="vertical-align:middle; margin-right: 4px;"
                                        src={{people?.attributes?.image?.data?.attributes?.image}} height="30" />
                                    <span>{{ people.attributes.first_name }} {{people.attributes.last_name}}</span>
                                </mat-option>
                            </mat-select>
                            <mat-error>Required Field</mat-error>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>